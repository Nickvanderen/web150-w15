<!doctype html>
  <html>
    <head>
      <meta charset=utf8>
      <title>Assignment 9 Ajax</title>
      <style>
.output {
  border: 1px solid black;
  height: 200px;
  overflow: scroll;
}
      </style>
    </head>
  <body>

    <div class="output"></div>
    <button class="load" data-cat="more">LOAD MORE</button>



    <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script>
var url = "http://thomaswilburn.net:8080/social";
var loadButton = $(".load");
var output = $(".output")
var update = $()
var lastUpdate = 1;

var whenDone = function(data) {
  lastUpdate = data.at;
  for (var i = 0; i <data.updates.length; i++) {
    var update = data.update[i];
    var text = update.output + ": " + update.text + "<br>";
    output.append(text);
  }
};

var getUpdate = function() {
    var request = $.ajax({
      url:"http://thomaswilburn.net:8080/social",
      data: {
        since: lastUpdate
      }
    });
    request.done(whenDone);
};
var poll = function() {
  getUpdate();
};

poll();

var sendUpdate = function() {
  var update = inputUpdate.val();
}

var request = $.ajex({
  url:"http://thomaswilburn.net:8080/social",
  type: "POST",
  data: JSON.stringify({
    update: update,
    since: lastUpdate
  })
});
  request.done(whenDone);


loadButton.on("click", sendUpdate);
inputUpdate.on("click", function(e) {
  if (e.keyCode == 13) {
    sendUpdate();
  }
});

    </script>
  </body>
</html>
